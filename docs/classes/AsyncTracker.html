<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>angular-async-tracker documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	    <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">angular-async-tracker documentation</a>
            <button type="button" class="btn btn-default btn-menu fa fa-bars" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <div id="book-search-input" role="search">
                <input type="text" placeholder="Type to search">
            </div>
            <nav>
            
                <ul class="list">
            
                    <li class="title">
                        <a href="../">angular-async-tracker documentation</a>
                    </li>
            
                    <li class="divider"></li>
            
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../"><span class="fa fa-home"></span>Getting started</a>
                        <ul class="links">
                                <li class="link">
                                    <a href="../" ><span class="fa fa-file-text-o"></span>README</a>
                                </li>
                                <li class="link">
                                    <a 
                                        
                                         href="../overview.html" 
                                         href="../overview.html" 
                                        >
                                        <span class="fa fa-th"></span>Overview
                                    </a>
                                </li>
                        </ul>
                    </li>
            
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../modules.html" >
                            <span class="fa fa-archive"></span>
                            <span>Modules</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-modules-links"
                            ></span>
                        </a>
                        <ul class="links collapse in"
                                id="xs-modules-links"
                            >
                                <li class="link">
                                    <a href="../modules/AsyncTrackerModule.html" >AsyncTrackerModule</a>
                                </li>
                        </ul>
                    </li>
            
            
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-file-code-o"></span>
                            <span>Classes</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-classes-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-classes-links"
                            >
                                <li class="link">
                                    <a href="../classes/AsyncTracker.html"  class="active" >AsyncTracker</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-long-arrow-down"></span>
                            <span>Injectables</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-injectables-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-injectables-links"
                            >
                                <li class="link">
                                    <a href="../injectables/AsyncTrackerFactory.html" >AsyncTrackerFactory</a>
                                </li>
                        </ul>
                    </li>
            
            
            
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../miscellaneous.html" ><span class="fa fa-cubes"></span>Miscellaneous</a>
                    </li>
            
            
                    <li class="divider"></li>
                    <li class="copyright">
                            Documentation generated using <a href="https://compodoc.github.io/website/" target="_blank">
                                        <img src="..//images/compodoc-vectorise.svg" class="img-responsive">
                            </a>
                    </li>
            
                </ul>
            
            </nav>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <nav>
                   
                       <ul class="list">
                   
                           <li class="title">
                               <a href="../">angular-async-tracker documentation</a>
                           </li>
                   
                           <li class="divider"></li>
                   
                               <div id="book-search-input" role="search">
                                   <input type="text" placeholder="Type to search">
                               </div>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../"><span class="fa fa-home"></span>Getting started</a>
                               <ul class="links">
                                       <li class="link">
                                           <a href="../" ><span class="fa fa-file-text-o"></span>README</a>
                                       </li>
                                       <li class="link">
                                           <a 
                                               
                                                href="../overview.html" 
                                                href="../overview.html" 
                                               >
                                               <span class="fa fa-th"></span>Overview
                                           </a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../modules.html" >
                                   <span class="fa fa-archive"></span>
                                   <span>Modules</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#modules-links"
                                   ></span>
                               </a>
                               <ul class="links collapse in"
                                       id="modules-links"
                   >
                                       <li class="link">
                                           <a href="../modules/AsyncTrackerModule.html" >AsyncTrackerModule</a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-file-code-o"></span>
                                   <span>Classes</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#classes-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="classes-links"
                   >
                                       <li class="link">
                                           <a href="../classes/AsyncTracker.html"  class="active" >AsyncTracker</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-long-arrow-down"></span>
                                   <span>Injectables</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#injectables-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="injectables-links"
                   >
                                       <li class="link">
                                           <a href="../injectables/AsyncTrackerFactory.html" >AsyncTrackerFactory</a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                   
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../miscellaneous.html" ><span class="fa fa-cubes"></span>Miscellaneous</a>
                           </li>
                   
                   
                           <li class="divider"></li>
                           <li class="copyright">
                                   Documentation generated using <a href="https://compodoc.github.io/website/" target="_blank">
                                               <img src="..//images/compodoc-vectorise.svg" class="img-responsive">
                                   </a>
                           </li>
                   
                       </ul>
                   
                   </nav>
               </div>
               <div class="content class">
                   <div class="content-data">






<ol class="breadcrumb">
  <li>Classes</li>
  <li>AsyncTracker</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
    <li class="active">
        <a href="#infos" id="infos-tab" role="tab" data-toggle="tab">Infos</a>
    </li>
    <li>
        <a href="#source" role="tab" id="source-tab" data-toggle="tab">Source</a>
    </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="infos">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/async-tracker-factory.service.ts</code>
        </p>




            <section>
                <h3 id="constructor">Constructor</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <code>constructor(trackerOptions: <a href="../classes/AsyncTracker.html">AsyncTrackerOptions</a>)</code>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="68" class="link-to-prism">src/async-tracker-factory.service.ts:68</a></div>
                                    </td>
                                </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <ul class="jsdoc-params">
                                                        <li>
                                                            <div>
                                                                <b>trackerOptions</b>
                                                            </div>
                                                            <div>
                                                                <p>.activationDelay - number of milliseconds that an added promise needs to be pending before this tracker is active.</p>
            
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                <b>trackerOptions</b>
                                                            </div>
                                                            <div>
                                                                <p>.minDuration - Minimum number of milliseconds that a tracker will stay active.</p>
            
                                                            </div>
                                                        </li>
                                                </ul>
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>

            <section>
                
                    <h3 id="methods">
                        Methods
                    </h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <b> add</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
            <code>add(promiseOrSubscription: Promise<any> | Subscription | PromiseOrSubscription[])</code>
                                </td>
                            </tr>
            
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="108" class="link-to-prism">src/async-tracker-factory.service.ts:108</a></div>
                                    </td>
                                </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Add any arbitrary promise or observable subscription to the tracker.<br><code>tracker.active</code> will be true until a promise is resolved or rejected or a subscription emits the first value.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns: </b>    <code>void</code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <b> clear</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
            <code>clear()</code>
                                </td>
                            </tr>
            
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="158" class="link-to-prism">src/async-tracker-factory.service.ts:158</a></div>
                                    </td>
                                </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Causes a tracker to immediately become inactive and stop tracking all current promises and subscriptions.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns: </b>    <code>void</code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>


            <section>
                
                    <h3 id="inputs">
                        Properties
                    </h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <b> active</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <code>active:     <code>boolean</code>
            </bcode>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="84" class="link-to-prism">src/async-tracker-factory.service.ts:84</a></div>
                                    </td>
                                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Returns whether this tracker is currently active. That is, whether any of the promises added to/created by this tracker<br>are still pending. Note: if the <code>activationDelay</code> has not elapsed yet, this will return false.</p>
            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <b> active$</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <code>active$:     <code>Subject&lt;boolean&gt;</code>
            </bcode>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="68" class="link-to-prism">src/async-tracker-factory.service.ts:68</a></div>
                                    </td>
                                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>An observable that emits true or false as the value for <code>active</code> changes</p>
            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <b> tracking</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <code>tracking:     <code>boolean</code>
            </bcode>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="100" class="link-to-prism">src/async-tracker-factory.service.ts:100</a></div>
                                    </td>
                                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Returns whether this tracker is currently tracking a request.<br>That is, whether any of the promises / subscriptions added to/created by this tracker are still pending.<br>This method has no regard for <code>activationDelay</code>.</p>
            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <b> trackingCount</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <code>trackingCount:     <code>number</code>
            </bcode>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <div class="io-line">Defined in <a href="" data-line="91" class="link-to-prism">src/async-tracker-factory.service.ts:91</a></div>
                                    </td>
                                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The count of promises or subscriptions currently being tracked.</p>
            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>
    <div class="tab-pane fade tab-source-code" id="source">
        <pre class="line-numbers"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { Subscription } from &#x27;rxjs/Subscription&#x27;;
import { Subject } from &#x27;rxjs/Subject&#x27;;

const isActive: symbol &#x3D; Symbol(&#x27;isActive&#x27;);
const tracking: symbol &#x3D; Symbol(&#x27;tracking&#x27;);
const options: symbol &#x3D; Symbol(&#x27;options&#x27;);
const activationDelayTimeout: symbol &#x3D; Symbol(&#x27;activationDelayTimeout&#x27;);
const minDurationTimeout: symbol &#x3D; Symbol(&#x27;minDurationTimeout&#x27;);

function isPromise(value: any): boolean {
  return typeof value.then &#x3D;&#x3D;&#x3D; &#x27;function&#x27; &amp;&amp; typeof value.catch &#x3D;&#x3D;&#x3D; &#x27;function&#x27;;
}

function isSubscription(value: any): boolean {
  return value instanceof Subscription;
}

function removeFromTracking(tracker: AsyncTracker, promiseOrSubscription: PromiseOrSubscription): void {
  if (tracker[minDurationTimeout]) {
    tracker[minDurationTimeout].promise.then(() &#x3D;&gt; {
      removeFromTracking(tracker, promiseOrSubscription);
    });
  } else {
    tracker[tracking] &#x3D; tracker[tracking].filter(item &#x3D;&gt; item !&#x3D;&#x3D; promiseOrSubscription);
    if (tracker[tracking].length &#x3D;&#x3D;&#x3D; 0 &amp;&amp; tracker[activationDelayTimeout]) {
      tracker[activationDelayTimeout].cancel();
      delete tracker[activationDelayTimeout];
    }
    updateIsActive(tracker);
  }
}

function updateIsActive(tracker: AsyncTracker): void {
  if (!tracker[activationDelayTimeout] &amp;&amp; (!tracker[minDurationTimeout] || !tracker[isActive])) {
    const oldValue: boolean &#x3D; tracker[isActive];
    tracker[isActive] &#x3D; tracker[tracking].length &gt; 0;
    if (oldValue !&#x3D;&#x3D; tracker[isActive]) {
      tracker.active$.next(tracker[isActive]);
    }
  }
}

function timeoutPromise(duration: number): {promise: Promise&lt;any&gt;, cancel: Function} {
  let cancel: Function;
  const promise: Promise&lt;any&gt; &#x3D; new Promise((resolve) &#x3D;&gt; {
    const timerId: any &#x3D; setTimeout(() &#x3D;&gt; resolve(), duration);
    cancel &#x3D; () &#x3D;&gt; {
      clearTimeout(timerId);
      resolve();
    };
  });
  return {cancel, promise};
}

export type PromiseOrSubscription &#x3D; Promise&lt;any&gt; | Subscription;

export interface AsyncTrackerOptions {
  activationDelay?: number;
  minDuration?: number;
}

export class AsyncTracker {

  /**
   * An observable that emits true or false as the value for &#x60;active&#x60; changes
   */
  active$: Subject&lt;boolean&gt; &#x3D; new Subject();

  /**
   * @param trackerOptions.activationDelay - number of milliseconds that an added promise needs to be pending before this tracker is active.
   * @param trackerOptions.minDuration - Minimum number of milliseconds that a tracker will stay active.
   */
  constructor(trackerOptions: AsyncTrackerOptions &#x3D; {}) {
    this[tracking] &#x3D; [];
    this[options] &#x3D; trackerOptions;
    updateIsActive(this);
  }

  /**
   * Returns whether this tracker is currently active. That is, whether any of the promises added to/created by this tracker
   * are still pending. Note: if the &#x60;activationDelay&#x60; has not elapsed yet, this will return false.
   */
  get active(): boolean {
    return this[isActive];
  }

  /**
   * The count of promises or subscriptions currently being tracked.
   */
  get trackingCount(): number {
    return this[tracking].length;
  }

  /**
   * Returns whether this tracker is currently tracking a request.
   * That is, whether any of the promises / subscriptions added to/created by this tracker are still pending.
   * This method has no regard for &#x60;activationDelay&#x60;.
   */
  get tracking(): boolean {
    return this[tracking].length &gt; 0;
  }

  /**
   * Add any arbitrary promise or observable subscription to the tracker.
   * &#x60;tracker.active&#x60; will be true until a promise is resolved or rejected or a subscription emits the first value.
   */
  add(promiseOrSubscription: PromiseOrSubscription | PromiseOrSubscription[]): void {

    const startMinDuration: () &#x3D;&gt; void &#x3D; () &#x3D;&gt; {
      if (this[options].minDuration &amp;&amp; !this[minDurationTimeout] &amp;&amp; this[tracking].length &gt; 0) {
        this[minDurationTimeout] &#x3D; timeoutPromise(this[options].minDuration);
        this[minDurationTimeout].promise.then(() &#x3D;&gt; {
          delete this[minDurationTimeout];
          updateIsActive(this);
        });
      }
    };

    if (Array.isArray(promiseOrSubscription)) {
      promiseOrSubscription.forEach(arrayItem &#x3D;&gt; this.add(arrayItem));
    } else {
      this[tracking].push(promiseOrSubscription);
      if (this[tracking].length &#x3D;&#x3D;&#x3D; 1) {
        if (this[options].activationDelay) {
          this[activationDelayTimeout] &#x3D; timeoutPromise(this[options].activationDelay);
          this[activationDelayTimeout].promise.then(() &#x3D;&gt; {
            delete this[activationDelayTimeout];
            startMinDuration();
            updateIsActive(this);
          });
        } else {
          startMinDuration();
        }
      }
      updateIsActive(this);
      if (isPromise(promiseOrSubscription)) {
        const promise: Promise&lt;any&gt; &#x3D; promiseOrSubscription as Promise&lt;any&gt;;
        promise.then(() &#x3D;&gt; {
          removeFromTracking(this, promiseOrSubscription);
        }, () &#x3D;&gt; {
          removeFromTracking(this, promiseOrSubscription);
        });
      } else if (isSubscription(promiseOrSubscription)) {
        const subscription: Subscription &#x3D; promiseOrSubscription as Subscription;
        subscription.add(() &#x3D;&gt; {
          removeFromTracking(this, promiseOrSubscription);
        });
      } else {
        throw new Error(&#x27;asyncTracker.add expects either a promise or an observable subscription.&#x27;);
      }
    }
  }

  /**
   * Causes a tracker to immediately become inactive and stop tracking all current promises and subscriptions.
   */
  clear(): void {
    if (this[activationDelayTimeout]) {
      this[activationDelayTimeout].cancel();
      delete this[activationDelayTimeout];
    }
    if (this[minDurationTimeout]) {
      this[minDurationTimeout].cancel();
      delete this[minDurationTimeout];
    }
    this[tracking] &#x3D; [];
    updateIsActive(this);
  }

}

@Injectable()
export class AsyncTrackerFactory {

  create(trackerOptions?: AsyncTrackerOptions): AsyncTracker {
    return new AsyncTracker(trackerOptions);
  }

}</code></pre>
    </div>
</div>





                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
           </div>
       </div>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script>var COMPODOC_CURRENT_PAGE_DEPTH = 1;</script>

       <script src="../js/search/search.js"></script>
       <script src="../js/search/lunr.min.js"></script>
       <script src="../js/search/search-lunr.js"></script>

       <script src="../js/menu.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/search/search_index.js"></script>

    </body>
</html>
